# 投影片播放與 PPTX 匯出一致性分析與改進計畫

## 問題摘要

分析 `PresentationView.vue`（播放模式）與 `pptx-export.ts`（PPTX 匯出）的版面結構，發現多處不一致的問題需要修正。

---

## 版面差異分析

### 1. 專案詳細投影片 (Project Slide) 結構比較

| 版面區塊 | PresentationView.vue（播放） | pptx-export.ts（匯出） | 差異說明 |
|---------|--------------------------|---------------------|---------|
| **Header** | 燈號 + 專案名稱 + Tags（狀態、進度、窗口、分類） | 燈號 + 專案名稱（無 Tags） | ❌ Tags 未匯出 |
| **部門資訊** | 主辦 + 分隔線 + 協辦（橫向顯示） | 用表格顯示「窗口」和「分類」 | ❌ 結構完全不同 |
| **時程** | Gantt chart 箭頭樣式 + 今日標記 | 純文字："階段名: 開始 ~ 結束" | ❌ 視覺呈現差異大 |
| **會辦狀況** | 日期 + 內容（支援 tracking/planned 標記） | 日期 + 內容（支援顏色標記） | ✅ 基本一致 |
| **其他補充** | 列表樣式，支援 tracking/planned | 純文字列點 | ⚠️ 基本一致，但樣式有差 |
| **底部版面** | 2/3 會辦 + 1/3 補充（並排） | 上下垂直排列 | ❌ 版面結構不同 |

### 2. 總覽投影片 (Summary Slide) 結構比較

| 版面區塊 | PresentationView.vue | pptx-export.ts | 差異說明 |
|---------|---------------------|----------------|---------|
| **標題** | 「專案進展彙整 N」 | 「專案進展彙整 N」 | ✅ 一致 |
| **表格欄位** | 燈號、專案名稱、狀態、進度、窗口 | 燈號、專案名稱、狀態、進度、窗口 | ✅ 一致 |

### 3. SlidePreview.vue 與 PresentationView.vue 差異

> [!NOTE]
> 這是之前對談 "Aligning Slide Preview Layout" 已處理的部分，基本結構已對齊。

| 版面區塊 | PresentationView.vue | SlidePreview.vue |
|---------|---------------------|-----------------|
| Header 結構 | ✅ | ✅ 已對齊 |
| 部門列（含分隔線） | ✅ | ✅ 已對齊 |
| 時程標籤 | `.section-label` | `.section-label` ✅ |
| 會辦標籤 | `.section-label` | `.section-title` ⚠️ 不一致 |

---

## 建議修正項目

> [!IMPORTANT]
> 以下修正確保 PPTX 匯出能反映播放投影片的版面結構與資訊。

### 高優先級

#### [MODIFY] [pptx-export.ts](file:///Users/kywk/Dropbox/project/sheltie/frontend/src/utils/pptx-export.ts)

1. **Header 區塊**：在專案名稱旁加入 Tags (狀態、進度、窗口、分類)
2. **部門資訊**：改為橫向顯示「主辦：xxx │ 協辦：xxx」
3. **時程區塊**：改用箭頭/方塊呈現 Gantt chart（或至少加入顏色區隔）
4. **底部版面**：會辦狀況和其他補充改為兩欄並排配置（2:1 比例）

### 中優先級

#### [MODIFY] [SlidePreview.vue](file:///Users/kywk/Dropbox/project/sheltie/frontend/src/components/SlidePreview.vue)

1. **會辦標籤**：將 `.section-title` 改為 `.section-label` 以與播放模式一致

---

## PPTX 匯出修正詳細規格

### 專案投影片新版面結構

```
┌────────────────────────────────────────────────────────────┐
│ 🟢 專案名稱    [狀態] [進度%] [窗口] [分類]                    │
├────────────────────────────────────────────────────────────┤
│ 主辦：部門A　│　協辦：部門B, 部門C                              │
├────────────────────────────────────────────────────────────┤
│ 時程                                                        │
│ ┌──────────┐┌──────────┐┌──────────┐                       │
│ │ 規劃階段  ││ 執行階段  ││ 驗收階段  │（箭頭形狀 + 顏色）      │
│ │ 1/1~2/28 ││ 3/1~5/31 ││ 6/1~6/30 │                       │
│ └──────────┘└──────────┘└──────────┘                       │
├────────────────────────────────────┬───────────────────────┤
│ 會辦狀況 (2/3 寬度)                 │ 其他補充 (1/3 寬度)    │
│ 2024/12/20                         │ • 補充事項1            │
│   - 會議結論A                       │ • 補充事項2            │
│   - ==追蹤事項B==                   │                       │
│ 2024/12/15                         │                       │
│   - 歷史紀錄                        │                       │
└────────────────────────────────────┴───────────────────────┘
```

### 顏色映射（參考 timeline.ts）

| 階段索引 | 顏色 |
|---------|-----|
| 0 | `#3b82f6` (Blue) |
| 1 | `#22c55e` (Green) |
| 2 | `#f59e0b` (Amber) |
| 3 | `#8b5cf6` (Purple) |
| 4+ | `#64748b` (Slate) |

---

## 驗證計畫

### 手動驗證

1. **播放與匯出比對**
   - 在瀏覽器開啟投影片播放模式 (`/presentation/:id`)
   - 點擊匯出按鈕下載 PPTX
   - 用 PowerPoint/LibreOffice 開啟匯出檔案
   - 逐頁比對：
     - [ ] 總覽頁表格內容一致
     - [ ] 專案頁 Header Tags 呈現
     - [ ] 部門資訊橫排顯示
     - [ ] 時程區塊視覺對應
     - [ ] 底部兩欄並排配置

2. **特殊樣式驗證**
   - [ ] 追蹤事項（==text==）為紅色粗體
   - [ ] 預計事項為藍色斜體
   - [ ] 舊會議記錄為灰色

---

## User Review Required

> [!WARNING]
> 以下問題需要您確認後再進行實作：

1. **時程 Gantt Chart**：PPTX 的 pptxgenjs 不支援完整的 CSS clip-path 箭頭效果，可選方案：
   - **方案 A**：使用方塊 + 顏色區隔（較簡單，視覺接近度中等）
   - **方案 B**：使用 AutoShape 繪製箭頭（較複雜，視覺效果最接近）
   - **方案 C**：維持純文字但加入顏色標記（最簡單）

2. **會辦狀況限制**：目前播放模式限制顯示 4 筆會議、每筆 3 行；PPTX 匯出限制 5 筆會議、每筆 2 行。是否需要統一？

請確認以上分析，我將依此進行實作。
